<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ollama Chat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="layout">
    
    <aside class="sidebar left">      
      <!-- Left sidebar content -->
      {% if session.username %}
        <p>Welcome, {{ session.username }}! 
          <a href="{{ url_for('change_password') }}">Change Password</a> | 
          <a href="{{ url_for('logout') }}">Logout</a>
        </p>
      {% else %}
        <p><a href="{{ url_for('login') }}">Login</a></p>
      {% endif %}
      <button onclick="window.location.href='/new_chat'">New Chat</button><br><br>
      <button onclick="window.location.href='/export_markdown'">Export Markdown</button>
    </aside>
    
    <main class="content">
      <!-- Main chat/content goes here -->
      <h1>Chat with Ollama ({{session.last_model}})</h1>

      <div class="chat-box">
          {% for entry in chat_history %}
              <div class="message {{ entry.role }}" >
                  <strong>{{ entry.role.capitalize() }}:</strong><br>
                  {{ entry.content | safe }}
                  {% if entry.role == 'assistant' %}
                    <button class="copy-raw-btn" data-raw="{{ entry.raw | e }}">Copy raw markdown</button>
                  {% endif %}
              </div>
          {% endfor %}
      </div>

      {% if error %}
          <div style="color:red;">⚠️ {{ error }}</div>
      {% endif %}

      <form method="POST" id="chat-form">
          <textarea name="prompt" id="prompt" rows="2" required placeholder="Type your message..."></textarea>
          <button type="submit">Send</button>
      </form>

    </main>
    
    <aside class="sidebar right">
      <!-- Right sidebar content -->
      <!-- empty for now -->
      <div class="model-selector">
        <label for="model-select">Select Language Model:</label>
        <select id="model-select" name="model">
            <option value="{{ session.last_model if 'last_model' in session else 'gpt-3.5-turbo' }}">
                {{ session.last_model if 'last_model' in session else 'gpt-3.5-turbo' }}
            </option>
            {% for model in allowed_models %}
                <option value="{{ model }}">{{ model }}</option>
            {% endfor %}
        </select>
        <button type="submit" form="model-form">Update Model</button>
    </div>

    <form id="model-form" action="{{ url_for('set_model') }}" method="POST">
        <!-- Hidden input to capture the selected model -->
        <input type="hidden" name="last_model" id="model-value">
    </form>

    <!-- Your existing chat form -->
    <form id="chat-form">
        <textarea id="prompt" placeholder="Type your message..."></textarea>
        <button type="submit">Send</button>
    </form>
    </aside>
    
  </div>

    <script src="{{ url_for('static', filename='main.js') }}" defer></script>

</body>
</html>

